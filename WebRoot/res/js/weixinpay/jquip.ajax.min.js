$.plug("ajax",function($){function _xhr(){if(_xhrf!=null)return _xhrf();for(var a=0,b=xhrs.length;a<b;a++)try{var c=xhrs[a],d=c();if(d!=null)return _xhrf=c,d}catch(e){}return function(){}}function _xhrResp(xhr,dataType){return dataType=(dataType||xhr.getResponseHeader("Content-Type").split(";")[0]).toLowerCase(),dataType.indexOf("json")>=0?window.JSON?window.JSON.parse(xhr.responseText):eval(xhr.responseText):dataType.indexOf("script")>=0?eval(xhr.responseText):dataType.indexOf("xml")>=0?xhr.responseXML:xhr.responseText}function ajax(a,b){var c=_xhr(),d,e=0;typeof a=="object"?b=a:b.url=a,b=$._defaults(b,{userAgent:"XMLHttpRequest",lang:"en",type:"GET",data:null,contentType:"application/x-www-form-urlencoded",dataType:null,processData:!0,headers:{"X-Requested-With":"XMLHttpRequest"}}),b.timeout&&(d=setTimeout(function(){c.abort(),b.timeoutFn&&b.timeoutFn(b.url)},b.timeout));var f=$(b.context||document),g=f;c.onreadystatechange=function(){if(c.readyState==4){d&&clearTimeout(d);if(c.status<300){var a=_xhrResp(c,b.dataType);b.success&&b.success(a),g.trigger("ajaxSuccess",[c,a,b])}else b.error&&b.error(c,c.status,c.statusText),g.trigger(f,"ajaxError",[c,c.statusText,b]);b.complete&&b.complete(c,c.statusText),g.trigger(f,"ajaxComplete",[c,b])}else b.progress&&b.progress(++e)};var a=b.url,h=null,i=b["type"]=="POST"||b["type"]=="PUT";b.data&&b.processData&&typeof b["data"]=="object"&&(h=$.formData(b.data)),!i&&h&&(a+="?"+h),c.open(b.type,a);try{for(var j in b.headers)c.setRequestHeader(j,b.headers[j])}catch(k){console.log(k)}i&&c.setRequestHeader("Content-Type",b.contentType),c.send(h)}var xhrs=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("MSXML2.XMLHTTP.3.0")},function(){return new ActiveXObject("MSXML2.XMLHTTP")}],_xhrf=null;$.xhr=_xhr,$._xhrResp=_xhrResp,$.formData=function(a){var b=[],c=/%20/g;for(var d in a)b.push(encodeURIComponent(d).replace(c,"+")+"="+encodeURIComponent(a[d].toString()).replace(c,"+"));return b.join("&")},$.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){$.fn[b]=function(a){return this.bind(b,a)}}),$.ajax=ajax,$.getJSON=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),ajax({url:a,data:b,success:c,dataType:"json"})},$.get=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),ajax({url:a,type:"GET",data:b,success:c,dataType:d||"text/plain"})},$.post=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),ajax({url:a,type:"POST",data:b,success:c,dataType:d||"text/plain"})},$.getScript=function(a,b){return $.get(a,undefined,b,"script")},window.JSON||$.loadAsync("http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js")})